# Docker Compose for multi-strategy trading deployment.
# Auto-generated by scripts/generate_compose.py - edit strategies.json instead.
#
# Usage:
#   cd deploy
#   docker compose up -d            # start all
#   docker compose logs -f          # tail logs
#   docker compose restart rsi-v3-gbpusd-m15  # restart one
#   docker compose down             # stop all

x-trader-common: &trader-common
  build:
    context: ..
    dockerfile: deploy/Dockerfile
  restart: unless-stopped
  env_file: .env

services:
  rsi-v3-gbpusd-m15:
    <<: *trader-common
    container_name: rsi-v3-gbpusd-m15
    volumes:
      - ../instances/rsi_v3_GBP_USD_M15:/instance
    command: >
      --strategy rsi_v3
      --pair GBP_USD
      --timeframe M15
      --params-file /instance/config.json
      --instance-dir /instance
      --instance-id rsi_v3_GBP_USD_M15
      --risk 1.0
      --yes

  rsi-v3-gbpusd-h1:
    <<: *trader-common
    container_name: rsi-v3-gbpusd-h1
    volumes:
      - ../instances/rsi_v3_GBP_USD_H1:/instance
    command: >
      --strategy rsi_v3
      --pair GBP_USD
      --timeframe H1
      --params-file /instance/config.json
      --instance-dir /instance
      --instance-id rsi_v3_GBP_USD_H1
      --risk 0.5
      --yes
    profiles:
      - disabled

  monitor:
    <<: *trader-common
    container_name: trading-monitor
    entrypoint: ["python", "scripts/run_monitor.py"]
    command: >
      --instances-dir /instances
      --telegram
      --interval 60
    volumes:
      - ../instances:/instances:ro
